{
  "name": "Ultimate-evolution",
  "tagline": "Snake?",
  "body": "<body onLoad=\"init();\">\r\n\r\n<table align=\"center\" border=\"1\" width=\"800\">\r\n \t<tr>\r\n \t\t<td>\r\n \t\t\t<br/>\r\n \t\t\t<table align=\"center\" border=\"1\" width=\"600\" height = \"70\">\r\n \t\t\t\t<td width=\"100\" align=\"center\" style=\"color: white; font-size: 28px;\">\r\n \t\t\t\t<b>避开<strong><font color=\"#FF4300\">熔岩</font></strong>，吞噬<strong><font color=\"#00FFFF\">晶体矿</font></strong>，变异出耐高温基因</b>\r\n \t\t\t\t</td>\r\n \t\t\t</table>\r\n\r\n \t\t\t<br/>\r\n\r\n\t\t\t<table align=\"center\" cellpadding=\"0\" cellspacing=\"0\" id=\"myTable\">\r\n\t\t\t</table>\r\n\r\n \t\t\t<table align=\"center\" border=\"1\" width=\"250\" height = \"50\">\r\n\r\n\r\n \t\t\t\t<td id = \"count\" width=\"150\" align=\"center\" style=\"color: yellow; font-size: 23px;\">\r\n \t\t\t\t按R键开始\r\n \t\t\t\t</td>\r\n\r\n \t\t\t</table>\r\n\r\n\r\n \t\t\t<table align=\"center\" border=\"0\" width=\"180\" height = \"50\">\r\n \t\t\t\t<td width=\"120\" align=\"center\" style=\"color: yellow; font-size: 23px;\">\r\n\r\n \t\t\t\t<input type=\"button\" value=\"重生(R)\" style=\"width:150px; height:35px; font-size: 23px; \" id = \"alive\" onClick=\"space();\" >\r\n\r\n \t\t\t\t</td>\r\n\r\n \t\t\t</table>\r\n\r\n \t\t\t<br/>\r\n\t\t</td>\r\n\t</tr>\r\n\r\n</table>\r\n\r\n\r\n</body>\r\n</html>\r\n<script>\r\nvar gaming;\r\nvar foodCount = 0;\r\nvar countMax = 20;\r\n\r\nvar button;\r\nvar display = document.getElementById(\"count\");\r\n\r\n\r\n\r\nvar sceneData = {\r\n\tmaxr: 23,//场景高度\r\n\tmaxc: 33,//场景宽度\r\n\tspeed: 100,\r\n\tdata : [],//场景地图\r\n\tsnakeData: [],\r\n\tdataType: [\"活动场地\", \"蛇\", \"熔岩\", \"食物\", \"熔岩蛇\"],//0场地、1蛇身、2熔岩、3食物、4熔岩蛇\r\n\tdataTypeColor: [\"#BDBDBD\", \"green\", \"#FF4300\", \"#00FFFF\", \"yellow\"],\r\n\tdirect: {r:0, c:-1 }   //移动方向\r\n}\r\n\r\n\tfunction init() {\r\n\t\tbutton = document.getElementById(\"alive\");\r\n\r\n\t\tgameInit();\r\n\r\n\t\t//gameStart();\r\n\r\n\t}\r\n\r\n\tfunction gameInit(){\r\n\t\tvar borderland = 3;\r\n\t\t//创建场景地图\r\n\t\tfor(var r=0; r< sceneData.maxr ; r++){\r\n\t\t\tvar rdata = [];\r\n\t\t\tfor(var c=0; c < sceneData.maxc ; c++){\r\n\t\t\t\tif(r < borderland || c < borderland || r > sceneData.maxr - borderland -1 || c > sceneData.maxc - borderland -1)\r\n\t\t\t\t\t//边界设为墙\r\n\t\t\t\t\tvar cdata = {r:r, c:c , type : 2 };\r\n\t\t\t\telse\r\n\t\t\t\t\tvar cdata = {r:r, c:c , type : 0 };\r\n\t\t\t\trdata.push(cdata);\r\n\t\t\t}\r\n\t\t\tsceneData.data.push(rdata);\r\n\t\t}\r\n\r\n\t\t//在中场创建蛇\r\n\t\tvar snakeBeginr = Math.ceil( sceneData.maxr / 2 );\r\n\t\tvar snakeBeginc = Math.ceil( sceneData.maxc / 2 );\r\n\t\tsceneData.snakeData.push({r: snakeBeginr, c: snakeBeginc});\r\n\r\n\t\t//蛇合并到场景数据\r\n\t\tfor(var i=0; i<sceneData.snakeData.length; i++){\r\n\t\t\tvar snakeNode = sceneData.snakeData[i];\r\n\t\t\tsceneData.data[ snakeNode.r ][ snakeNode.c ].type = 1;\r\n\t\t}\r\n\r\n\t\trefreshView();\r\n\r\n\r\n\t}\r\n\r\n\tfunction gameStart(){\r\n\t\t//console.log(\"开始\");\r\n\t\tgaming = true;\r\n\t\tbutton.value = \"结束(R)\";\r\n\r\n\t\t//初始食物创建\r\n\t\tfor (var i = 0; i < 5; i++) {\r\n\t\t\tmakeFood();\r\n\t\t}\r\n\r\n\t\tsetTimeout(fireMaker, 1500);\r\n\t\tfoodMaker();\r\n\t\tmoving();\r\n\t}\r\n\r\n\tfunction gameOver(){\r\n\t\t//console.log(\"结束\");\r\n\t\tgaming = false;\r\n\t\tbutton.value = \"重生(R)\";\r\n\r\n\r\n\t\t//console.log(\"gameOver\");\r\n\t}\r\n\r\n\t//刷新界面\r\n\tfunction refreshView(){//刷新界面\r\n\t\tvar myTable = document.getElementById('myTable');\r\n\t\tvar tableHtml = \"\";\r\n\t\tfor( var r =0; r< sceneData.data.length; r++){\r\n\t\t\tvar rdata = sceneData.data[r];\r\n\t\t\ttableHtml +=\"<tr>\";\r\n\t\t\tfor(var c=0; c< rdata.length; c++){\r\n\t\t\t\tvar color = sceneData.dataTypeColor[rdata[c].type];\r\n\t\t\t\ttableHtml += \"<td style='background-color:\"+ color +\";'>\";\r\n\t\t\t\ttableHtml += \"</td>\";\r\n\t\t\t}\r\n\t\t\ttableHtml +=\"</tr>\";\r\n\t\t}\r\n\t\tmyTable.innerHTML = tableHtml;\r\n\t}\r\n\r\n\t//制作食物\r\n\tfunction makeFood() {\r\n\t\tvar randomR = Math.ceil( Math.random()*10000 % sceneData.maxr ) -1 ;\r\n\t\tvar randomC = Math.ceil( Math.random()*10000 % sceneData.maxc ) -1 ;\r\n\t\tvar localNode = sceneData.data[ randomR ][ randomC ];\r\n\t\tif(localNode.type == 0){\r\n\t\t\tsceneData.data[ randomR ][ randomC ].type = 3;\r\n\t\t\tfoodCount++;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse{\r\n\t\t\treturn makeFood();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction foodMaker(){\r\n\t\tif(gaming == false)\r\n\t\t\treturn;\r\n\t\tif(foodCount < 8)\r\n\t\t\tmakeFood();\r\n\t\tsetTimeout(foodMaker, 2000);\r\n\t}\r\n\r\nvar t;//计时器\r\n\r\n\tfunction fireMaker() {\r\n\t\tif(gaming == false)\r\n\t\t\treturn;\r\n\t\tt = setTimeout(fireMaker, 1200);\r\n\r\n\t\tvar randomR = Math.ceil( Math.random()*10000 % sceneData.maxr ) -1 ;\r\n\t\tvar randomC = Math.ceil( Math.random()*10000 % sceneData.maxc ) -1 ;\r\n\t\tvar localNode = sceneData.data[ randomR ][ randomC ];\r\n\r\n\t\tif((localNode.type == 0 || localNode.type == 3) && Math.sqrt(Math.pow(randomR - sceneData.snakeData[0].r, 2) + Math.pow(randomC - sceneData.snakeData[0].c, 2)) > 3){\r\n\t\t\tsceneData.data[ randomR ][ randomC ].type = 2;\r\n\t\t\tif(localNode.type == 3){\r\n\t\t\t\tfoodCount--;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse{\r\n\t\t\tclearTimeout(t);\r\n\t\t\treturn fireMaker();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction moving() {\r\n\t\tif(gaming == false)\r\n\t\t\treturn;\r\n\t\t//循环计时器\r\n\t\tsetTimeout(moving, sceneData.speed);\r\n\r\n\t\t//生成新节点\r\n\t\tvar nextNode = {c: sceneData.snakeData[0].c + sceneData.direct.c ,\r\n\t\t\t\t\t\tr: sceneData.snakeData[0].r + sceneData.direct.r };\r\n\t\tvar nextsceneData = sceneData.data[ nextNode.r ][ nextNode.c] ;\r\n\r\n\t\t//下一点为蛇身\r\n\t\tif(nextsceneData.type == 1){\r\n\t\t\t//蛇身\r\n\r\n\t\t\tfor(var i=0; i<sceneData.snakeData.length; i++){\r\n\t\t\t\t//console.log(sceneData.snakeData[i]);\r\n\t\t\t\tif(sceneData.snakeData[i].c == nextNode.c && sceneData.snakeData[i].r == nextNode.r){\r\n\t\t\t\t\t//console.log(i);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\t\t//var snakeNode = sceneData.snakeData[i];\r\n\t\t\t\t\t//sceneData.data[ snakeNode.r ][ snakeNode.c ].type = 0;\r\n\t\t\t}\r\n\r\n\t\t\tfor(var j = i; j<sceneData.snakeData.length; j++){\r\n\t\t\t\tsceneData.data[sceneData.snakeData[j].r][sceneData.snakeData[j].c].type = 3;\r\n\t\t\t}\r\n\t\t\tfor(var j = i; j<sceneData.snakeData.length; j++){\r\n\t\t\t\tsceneData.snakeData.pop();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//移除现有蛇\r\n\t\tfor(var i=0; i<sceneData.snakeData.length; i++){\r\n\t\t\tvar snakeNode = sceneData.snakeData[i];\r\n\t\t\tsceneData.data[ snakeNode.r ][ snakeNode.c ].type = 0;\r\n\t\t}\r\n\r\n\t\t//判断下一节点类型\r\n\t\tif(nextsceneData.type == 0){\r\n\t\t\t\t//场地\r\n\t\t\t\t//删除最后结尾节点\r\n\t\t\t\tsceneData.snakeData.pop();\r\n\t\t\t\tsceneData.snakeData.unshift(nextNode);\r\n\t\t}\r\n\t\telse if(nextsceneData.type == 2){\r\n\t\t\t\t//熔岩\r\n\t\t\t\t//删除最后结尾节点\r\n\t\t\t\tsceneData.snakeData.pop();\r\n\t\t}\r\n\t\telse if(nextsceneData.type == 3){\r\n\t\t\t\t//食物\r\n\t\t\t\tsceneData.snakeData.unshift(nextNode);\r\n\t\t\t\tfoodCount--;\r\n\t\t}\r\n\r\n\t\t//更新场景的数据\r\n\t\tfor(var i=0; i<sceneData.snakeData.length; i++){\r\n\t\t\tvar snakeNode = sceneData.snakeData[i];\r\n\t\t\tsceneData.data[ snakeNode.r ][ snakeNode.c ].type = 1;\r\n\t\t}\r\n\r\n\t\tif(isDead()){\r\n\t\t\tdisplay.innerText = \"你死了伙计\";\r\n\r\n\t\t\tgameOver();\r\n\t\t\tallShallBurn();\r\n\t\t\trefreshView();\r\n\t\t}\r\n\t\telse{\r\n\t\t\tcount();\r\n\t\t\tif(sceneData.snakeData.length -1 == countMax)\r\n\t\t\t{\r\n\t\t\t\t//console.log(\"win\");\r\n\t\t\t\tgameWin();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\r\n\r\n\t\t//变长减速\r\n\t\tif(sceneData.snakeData.length < 10){\r\n\t\t\tsceneData.speed = 100 + 5 * (sceneData.snakeData.length - 1);\r\n\t\t\t//console.log(sceneData.speed);\r\n\t\t}\r\n\r\n\r\n\t\trefreshView();\r\n\t}\r\n\r\n\tfunction count(){\r\n\t\tvar text;\r\n\t\ttext = \"吞噬晶矿：\";\r\n\t\ttext += sceneData.snakeData.length - 1;\r\n\t\ttext += \" / \";\r\n\t\ttext += countMax;\r\n\r\n\t\tdisplay.innerText = text;\r\n\r\n\t}\r\n\r\nvar a;\r\n\r\n\tfunction gameWin(){\r\n\t\tgameOver();\r\n\t\ta = 0;\r\n\t\tevolution();\r\n\r\n\t\t//allShallBurn();\r\n\t\tdisplay.innerText = \"存活成功\";\r\n\r\n\t}\r\nvar t2\r\n\r\n\tfunction evolution(){\r\n\t\tif(a <= countMax){\r\n\t\t\tt2 = setTimeout(evolution, 200);\r\n\t\t\tvar snakeNode = sceneData.snakeData[a]\r\n\t\t\tsceneData.data[snakeNode.r][snakeNode.c].type = 4;\r\n\t\t\trefreshView();\r\n\t\t\ta = a + 1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tallShallBurn();\r\n\t\t\trefreshView();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction isDead(){\r\n\t\tif(sceneData.snakeData.length == 0)\r\n\t\t\treturn 1;\r\n\t\telse \r\n\t\t\treturn 0;\r\n\t}\r\n\r\n\tfunction allShallBurn(){\r\n\t\tfor( var r =0; r< sceneData.data.length; r++){\r\n\t\t\tvar rdata = sceneData.data[r];\r\n\t\t\tfor(var c=0; c< rdata.length; c++){\r\n\t\t\t\tvar data = sceneData.data[r][c];\r\n\t\t\t\tif(data.type != 2 && data.type != 4){\r\n\t\t\t\t\tdata.type = 2;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction space(){\r\n\t\t//console.log(\"R\");\r\n\r\n\t\tif(gaming){\r\n\t\t\tdisplay.innerText = \"按R键开始\";\r\n\t\t\tgameOver();\r\n\t\t\tallShallBurn();\r\n\t\t\trefreshView();\r\n\t\t}else{\r\n\t\t\tclearAndStart();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction clearAndStart(){\r\n\t\tsceneData.data.length = 0;\r\n\t\tsceneData.snakeData.length = 0;\r\n\t\tsceneData.direct = {r:0, c: -1};\r\n\t\tfoodCount = 0;\r\n\r\n\t\tsceneData.speed = 100;\r\n\t\tclearTimeout(t);\r\n\t\tclearTimeout(t2);\r\n\r\n\r\n\t\tgameInit();\r\n\r\n\t\tgameStart();\r\n\t}\r\n\t//按键捕捉\r\n\tdocument.onkeydown=function(e){\r\n\t\t//console.log(e.keyCode);\r\n\t\tif(gaming){\r\n\t\t\tif((sceneData.data[sceneData.snakeData[0].r][sceneData.snakeData[0].c - 1].type != 1) && (e.keyCode == 37 || e.keyCode == 65)){//左\r\n\t\t\t\tsceneData.direct = {r:0, c: -1};\r\n\t\t\t}else if((sceneData.data[sceneData.snakeData[0].r - 1][sceneData.snakeData[0].c].type != 1) && (e.keyCode == 38 || e.keyCode == 87)){//上\r\n\t\t\t\tsceneData.direct = {r:-1, c: 0};\r\n\t\t\t}else if((sceneData.data[sceneData.snakeData[0].r][sceneData.snakeData[0].c + 1].type != 1) && (e.keyCode == 39 || e.keyCode == 68)){//右\r\n\t\t\t\tsceneData.direct = {r:0, c: 1};\r\n\t\t\t}else if((sceneData.data[sceneData.snakeData[0].r + 1][sceneData.snakeData[0].c].type != 1) && (e.keyCode == 40 || e.keyCode == 83)){//下\r\n\t\t\t\tsceneData.direct = {r:1, c: 0};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//按R\r\n\t\tif(e.keyCode == 82){\r\n\t\t\tspace();\r\n\t\t}\r\n\t}\r\n\r\n\r\n</script>",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}